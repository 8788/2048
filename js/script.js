!function(a,b,c){"use strict";var d={linear:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b}};a.console||(a.console={log:function(){},error:function(){}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xa0\u3000\u00A0]+|[\s\uFEFF\xa0\u3000\u00A0]+$/g,"")});var e={getStyle:function(a,b){return a.currentStyle?a.currentStyle[b]:getComputedStyle(a,!1)[b]},getByClass:function(a,c){if(c=c||b,c.getElementsByClassName)return c.getElementsByClassName(a);for(var d=new RegExp("(^|\\s)"+a+"($|\\s)","i"),e=[],f=c.getElementsByTagName("*"),g=0,h=f.length;g<h;g++)d.test(f[g].className)&&e.push(f[g]);return e},bindEvent:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,function(){c.call(a,event)}):a["on"+b]=function(a){var b=a||event;c(b)}},hasClass:function(a,b){return a.classList?a.classList.contains(b):new RegExp("(^|\\s)"+b+"($|\\s)","i").test(a.className)},addClass:function(a,b){e.hasClass(a,b)||(a.classList?a.classList.add(b):a.className=(a.className.trim()+" "+b).trim())},removeClass:function(a,b){if(e.hasClass(a,b))if(a.classList)a.classList.remove(b);else{var c=new RegExp("(^|\\s+)"+b+"($|\\s+)","ig");a.className=a.className.replace(c," ").trim()}},toggleClass:function(a,b){e.hasClass(a,b)?e.removeClass(a,b):e.addClass(a,b)},animate:function(a,b,c){c=c||{},c.duration=c.duration||400,c.easing=c.easing||"linear";var f=+new Date,g={};for(var h in b)g[h]="opacity"===h?Math.round(100*e.getStyle(a,h)):parseInt(e.getStyle(a,h),10);clearInterval(a.timer),a.timer=setInterval(function(){var e=Math.min(+new Date-f,c.duration);for(var h in b){var i=d[c.easing](e,g[h],parseInt(b[h],10)-g[h],c.duration);"opacity"===h?(a.style.opacity=i/100,a.style.filter="alpha(opacity = "+i+")"):a.style[h]=i+"px"}e>=c.duration&&(clearInterval(a.timer),c.complete&&c.complete())},20)}};a.util=e}(window,document),function(a){"use strict";function b(){for(var a=0;a<4;a++){s[a]=new Array,t[a]=new Array;for(var b=0;b<4;b++)s[a][b]=0,t[a][b]=!0}}function c(a){for(var b=0;b<4;b++)for(var c=0;c<4;c++)t[b][c]=!0;a&&a(s)}function d(a){for(var b=Math.random()>.4?2:4,c=[],d=0;d<4;d++)for(var e=0;e<4;e++)0===s[d][e]&&c.push([d,e]);var f=c.length;if(0!==f){var g=parseInt(Math.random()*f,10),h=c[g][0],i=c[g][1];s[h][i]=b,a&&a(h,i,b)}}function e(){for(var a=0;a<4;a++)for(var b=1;b<4;b++)if(0!==s[a][b]&&(0===s[a][b-1]||s[a][b-1]===s[a][b]))return!0;return!1}function f(){for(var a=1;a<4;a++)for(var b=0;b<4;b++)if(0!==s[a][b]&&(0===s[a-1][b]||s[a-1][b]===s[a][b]))return!0;return!1}function g(){for(var a=0;a<4;a++)for(var b=2;b>=0;b--)if(0!==s[a][b]&&(0===s[a][b+1]||s[a][b+1]===s[a][b]))return!0;return!1}function h(){for(var a=2;a>=0;a--)for(var b=0;b<4;b++)if(0!==s[a][b]&&(0===s[a+1][b]||s[a+1][b]===s[a][b]))return!0;return!1}function i(a){for(var b=0;b<4;b++)for(var c=1;c<4;c++)if(0!==s[b][c])for(var d=0;d<c;d++)if(!n(b,d,c)&&(0===s[b][d]||s[b][d]===s[b][c])){m(b,c,b,d,a);break}}function j(a){for(var b=1;b<4;b++)for(var c=0;c<4;c++)if(0!==s[b][c])for(var d=0;d<b;d++)if(!o(c,d,b)&&(0===s[d][c]||s[d][c]===s[b][c])){m(b,c,d,c,a);break}}function k(a){for(var b=0;b<4;b++)for(var c=2;c>=0;c--)if(0!==s[b][c])for(var d=3;d>c;d--)if(!n(b,c,d)&&(0===s[b][d]||s[b][d]===s[b][c])){m(b,c,b,d,a);break}}function l(a){for(var b=2;b>=0;b--)for(var c=0;c<4;c++)if(0!==s[b][c])for(var d=3;d>b;d--)if(!o(c,b,d)&&(0===s[d][c]||s[d][c]===s[b][c])){m(b,c,d,c,a);break}}function m(a,b,c,d,e){0===s[c][d]?s[c][d]=s[a][b]:(s[c][d]+=s[a][b],r+=s[c][d],game.view.updateScore(r),t[c][d]=!1),s[a][b]=0,e&&e(a,b,c,d)}function n(a,b,c){for(var d=b+1;d<c;d++)if(0!==s[a][d])return!0;return!1}function o(a,b,c){for(var d=b+1;d<c;d++)if(0!==s[d][a])return!0;return!1}function p(){return!(e()||f()||g()||h())}function q(a){var b=localStorage.getItem("bestScore")||0;0===r?a&&a(b):r>b&&(localStorage.setItem("bestScore",r),a&&a(r))}var r=0,s=new Array,t=new Array;a.game=a.game||{},a.game.model={initModel:b,updateModel:c,newNumber:d,canMoveLeft:e,canMoveTop:f,canMoveRight:g,canMoveBottom:h,moveLeft:i,moveTop:j,moveRight:k,moveBottom:l,isGameOver:p,updateBestScore:q}}(window),function(a){"use strict";function b(){for(var a=0;a<4;a++)for(var b=0;b<4;b++){var d=document.createElement("div"),e=c(a,b);d.className="grid grid-"+a+"-"+b,d.style.top=e.top+"px",d.style.left=e.left+"px",k.appendChild(d)}}function c(a,b){return{top:i*a+j*(a+1),left:i*b+j*(b+1)}}function d(a){for(var b=util.getByClass("number",k),d=b.length-1;d>=0;d--)k.removeChild(b[d]);for(var d=0;d<4;d++)for(var e=0;e<4;e++){var f=a[d][e];if(0!==f){var g=document.createElement("div"),h=c(d,e);g.className="number number-"+d+"-"+e+" value-"+f,g.innerHTML=f,g.style.top=h.top+"px",g.style.left=h.left+"px",k.appendChild(g)}}}function e(a){util.getByClass("current")[0].innerHTML=a}function f(a){util.getByClass("best")[0].innerHTML=a}function g(a,b,d){var e=document.createElement("div"),f=c(a,b);e.className="number number-"+a+"-"+b+" value-"+d,e.innerHTML=d,e.style.top=f.top+40+"px",e.style.left=f.left+40+"px",e.style.width=0,e.style.height=0,k.appendChild(e),util.animate(e,{width:80,height:80,top:f.top,left:f.left},{duration:100})}function h(a,b,d,e){var f=util.getByClass("number-"+a+"-"+b,k)[0],g=c(d,e);util.animate(f,{top:g.top,left:g.left},{duration:200})}var i=80,j=15,k=document.getElementById("box");a.game=a.game||{},a.game.view={initGrid:b,updateView:d,updateScore:e,updateBestScore:f,newNumber:g,moveAnimate:h}}(window),function(a){"use strict";function b(){game.model.initModel(),game.view.initGrid(),game.model.newNumber(game.view.newNumber),game.model.newNumber(game.view.newNumber),game.model.updateBestScore(game.view.updateBestScore)}util.bindEvent(document,"keyup",function(a){switch(a.keyCode){case 37:game.model.canMoveLeft()&&(game.model.moveLeft(game.view.moveAnimate),setTimeout(function(){game.model.newNumber(game.view.newNumber)},250));break;case 38:game.model.canMoveTop()&&(game.model.moveTop(game.view.moveAnimate),setTimeout(function(){game.model.newNumber(game.view.newNumber)},250));break;case 39:game.model.canMoveRight()&&(game.model.moveRight(game.view.moveAnimate),setTimeout(function(){game.model.newNumber(game.view.newNumber)},250));break;case 40:game.model.canMoveBottom()&&(game.model.moveBottom(game.view.moveAnimate),setTimeout(function(){game.model.newNumber(game.view.newNumber)},250))}/37|38|39|40/g.test(a.keyCode)&&(setTimeout(function(){game.model.updateModel(game.view.updateView)},220),setTimeout(function(){game.model.isGameOver()&&(game.model.updateBestScore(game.view.updateBestScore),alert("game over"))},400))}),a.game=a.game||{},a.game.control={init:b}}(window);